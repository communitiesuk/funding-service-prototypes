{% extends "layouts/grantRecipient.html" %}

{% set showBackLink = true %}

{% set pageSize = "l" %}
{% set pageHeading = "Map Outputs data columns" %}
{% set pageSection = "data.fundName" %}
{% block pageTitle %}{{ macroPageTitle.pageTitle(pageHeading) }}{% endblock %}

{% block content %}

<div class="govuk-grid-row">
    <div class="govuk-grid-column-full">

<span class="govuk-caption-l">1 April 2026 to 30 June 2026</span>
<h1 class="govuk-heading-l">Map Outputs data columns</h1>

<p class="govuk-body">Map the data from each column to set its data type and settings in the grant form.</p>

<!-- <details class="govuk-details">
  <summary class="govuk-details__summary">
    <span class="govuk-details__summary-text">
      Snippet of uploaded data
    </span>
  </summary>
  <div class="govuk-details__text">
         <pre><code class="govuk-!-font-size-16" style="display: block; white-space: pre-wrap; background-color: #f3f2f1; padding: 15px;">{
  "row_index": 14,
  "status": "VALID",
  "parsed_data": {

    "grant recipient": {
      "value": Milton Keynes Council,
      "original_cell": "B15"
    },
    "capital_allocation": {
      "value": 4500000.00,
      "currency": "GBP",
      "original_cell": "C15"
    },
    "revenue_allocation": {
      "value": 1250000.00,
      "currency": "GBP",
      "original_cell": "D15"
    }
  },
  "metadata": {
    "upload_id": "8f902-b22a-4c11",
    "mapped_schema_version": "v1.2"
  }
}</code></pre>
  </div>
</details> -->

<table class="govuk-table">
  <thead class="govuk-table__head">
    <tr class="govuk-table__row">
      <th scope="col" class="govuk-table__header govuk-!-width-one-half">Column name</th>
      <th scope="col" class="govuk-table__header govuk-!-width-one-half">Example data</th>
      <th scope="col" class="govuk-table__header govuk-!-width-one-half">Data type</th>
    </tr>
  </thead>
  <tbody class="govuk-table__body">
    
    <!-- Row 1 -->
    <tr class="govuk-table__row">
      <td class="govuk-table__cell govuk-table__cell--middle">grant recipient</td>
      <td class="govuk-table__cell govuk-table__cell--middle">Birmingham City Council, Swindon City Council, York City Council</td>
      <td class="govuk-table__cell">
        <div class="govuk-form-group govuk-!-margin-bottom-2">
          <label class="govuk-label" for="data-type-recipient">
            Data type
          </label>
          <select class="govuk-select" id="data-type-recipient" name="data-type-recipient" onchange="handleTypeChange(this)">
            <option value="choose" selected>Select data type</option>
            <option value="text">Text</option>
            <option value="number">Whole number</option>
            <option value="decimal">Decimal number</option>
          </select>
        </div>
        
        <!-- Wrapper for conditional content (Inset Text style) -->
        <div class="govuk-inset-text js-conditional-wrapper" style="display: none; margin-top: 10px;">
          
          <!-- Config Field (Shows ONLY for Decimal) -->
          <div class="govuk-form-group js-config-field" style="display: none;">
            <label class="govuk-label" for="recipient-config">
              Decimal places
            </label>
            <input class="govuk-input govuk-input--width-4" id="recipient-config" name="recipient-config" type="text">
          </div>

          <!-- Min/Max Fields (Shows for Number AND Decimal) -->
           <label class="govuk-label" for="revenue-min">Formatting options (optional) </label>
          <div class="js-min-max-fields" style="display: none; gap: 10px;">
            <div class="govuk-form-group" style="margin-bottom: 0;">
              <label class="govuk-label" for="recipient-min">Prefix</label>
              <input class="govuk-input govuk-input--width-4" id="recipient-min" name="recipient-min" type="text">
            </div>
            <div class="govuk-form-group" style="margin-bottom: 0;">
              <label class="govuk-label" for="recipient-max">Suffix</label>
              <input class="govuk-input govuk-input--width-4" id="recipient-max" name="recipient-max" type="text">
            </div>
          </div>

        </div>
      </td>
    </tr>

    <!-- Row 2 -->
    <tr class="govuk-table__row">
      <td class="govuk-table__cell govuk-table__cell--middle">capital allocation</td>
      <td class="govuk-table__cell govuk-table__cell--middle">£4,500,000, £4,500,000, £4,500,000</td>
      <td class="govuk-table__cell">
        <div class="govuk-form-group govuk-!-margin-bottom-2">
          <label class="govuk-label" for="data-type-capital">
            Data type
          </label>
          <select class="govuk-select" id="data-type-capital" name="data-type-capital" onchange="handleTypeChange(this)">
            <option value="choose" selected>Select data type</option>
            <option value="text">Text</option>
            <option value="number">Whole number</option>
            <option value="decimal">Decimal number</option>
          </select>
        </div>

        <div class="govuk-inset-text js-conditional-wrapper" style="display: none; margin-top: 10px;">
          
          <div class="govuk-form-group js-config-field" style="display: none;">
            <label class="govuk-label" for="capital-config">
              Decimal places
            </label>
            <input class="govuk-input govuk-input--width-4" id="capital-config" name="capital-config" type="text">
          </div>
 <label class="govuk-label" for="revenue-min">Formatting options (optional) </label>
          <div class="js-min-max-fields" style="display: none; gap: 10px;">
            <div class="govuk-form-group" style="margin-bottom: 0;">
              <label class="govuk-label" for="capital-min">Prefix</label>
              <input class="govuk-input govuk-input--width-4" id="capital-min" name="capital-min" type="text">
            </div>
            <div class="govuk-form-group" style="margin-bottom: 0;">
              <label class="govuk-label" for="capital-max">Suffix</label>
              <input class="govuk-input govuk-input--width-4" id="capital-max" name="capital-max" type="text">
            </div>
          </div>

        </div>
      </td>
    </tr>

    <!-- Row 3 -->
    <tr class="govuk-table__row">
      <td class="govuk-table__cell govuk-table__cell--middle">revenue allocation</td>
      <td class="govuk-table__cell govuk-table__cell--middle">£1,250,000, £1,250,000, £1,250,000</td>
      <td class="govuk-table__cell">
        <div class="govuk-form-group govuk-!-margin-bottom-2">
          <label class="govuk-label" for="data-type-revenue">
            Data type
          </label>
          <select class="govuk-select" id="data-type-revenue" name="data-type-revenue" onchange="handleTypeChange(this)">
            <option value="choose" selected>Select data type</option>
            <option value="text">Text</option>
            <option value="number">Whole number</option>
            <option value="decimal">Decimal number</option>
          </select>
        </div>

        <div class="govuk-inset-text js-conditional-wrapper" style="display: none; margin-top: 10px;">
          
          <div class="govuk-form-group js-config-field" style="display: none;">
            <label class="govuk-label" for="revenue-config">
              Decimal places
            </label>
            <input class="govuk-input govuk-input--width-4" id="revenue-config" name="revenue-config" type="text">
          </div>
 <label class="govuk-label" for="revenue-min">Formatting options (optional) </label>
          <div class="js-min-max-fields" style="display: none; gap: 10px;">

            <div class="govuk-form-group" style="margin-bottom: 0;">
              <label class="govuk-label" for="revenue-min">Prefix </label>
              <input class="govuk-input govuk-input--width-4" id="revenue-min" name="revenue-min" type="text">
            </div>
            <div class="govuk-form-group" style="margin-bottom: 0;">
              <label class="govuk-label" for="revenue-max">Suffix</label>
              <input class="govuk-input govuk-input--width-4" id="revenue-max" name="revenue-max" type="text">
            </div>
          </div>

        </div>
      </td>
    </tr>

  </tbody>
</table>

  <br>
  <form method="post" action="uploaded_files_success">
            <button type="submit" class="govuk-button" data-module="govuk-button">
Upload data set
</button>
</form>
</div>
</div>

<br>
<p class="govuk-body-xs"><a href="data_warning">(Data missing/wrong symbol page)</a>
</p>

  	</div>

</div>

<script>
  function handleTypeChange(select) {
    const cell = select.closest('.govuk-table__cell');
    const wrapper = cell.querySelector('.js-conditional-wrapper');
    const configField = cell.querySelector('.js-config-field');
    const minMaxFields = cell.querySelector('.js-min-max-fields');
    
    // Reset all first
    wrapper.style.display = 'none';
    configField.style.display = 'none';
    minMaxFields.style.display = 'none';
    minMaxFields.style.display = 'none'; // reset flex display

    if (select.value === 'number') {
      // Show Wrapper + Min/Max ONLY
      wrapper.style.display = 'block';
      minMaxFields.style.display = 'flex'; 
    } else if (select.value === 'decimal') {
      // Show Wrapper + Config + Min/Max
      wrapper.style.display = 'block';
      configField.style.display = 'block';
      minMaxFields.style.display = 'flex';
    }
    // Text or Choose remains hidden
  }
</script>
{% endblock %}

