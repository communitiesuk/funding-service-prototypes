{% extends "layouts/grantManagement.html" %}

{% set navID = 'grantReports' %}
{% set showBackLink = false %}
{% set showBackApplicationsLink = false %}

{% set pageSize = "l" %}
{% set pageHeading = "Edit question" %}
{% if isUnassignedTask %}
    {% set pageSection = "Unassigned task" %}
{% else %}
    {% set pageSection = sectionName %}
{% endif %}
{% set pageHiddentext = "yes" %}
{% set pageNested = "yes" %}

{% block pageTitle %}{{ macroPageTitle.pageTitle(pageHeading) }}{% endblock %}

{% block content %}

<div class="govuk-grid-row">
    <div class="govuk-grid-column-full">

        {# Template-based breadcrumbs for edit question page #}
        {% set breadcrumbItems = [] %}
        {% set breadcrumbItems = (breadcrumbItems.push({
            text: "Reports",
            href: "/funding/grant/reports/"
        }), breadcrumbItems) %}

        {% if reportName %}
            {% set breadcrumbItems = (breadcrumbItems.push({
                text: reportName,
                href: "/funding/grant/reports/sections?reportId=" + currentReportId
            }), breadcrumbItems) %}
        {% endif %}

        {% set breadcrumbItems = (breadcrumbItems.push({
            text: "Sections and tasks",
            href: "/funding/grant/reports/sections?reportId=" + currentReportId
        }), breadcrumbItems) %}

        {% if taskName %}
            {% if isUnassignedTask %}
                {% set questionsHref = "/funding/grant/reports/questions?taskId=" + currentTaskId + "&reportId=" + currentReportId + "&unassigned=true" %}
            {% else %}
                {% set questionsHref = "/funding/grant/reports/questions?taskId=" + currentTaskId + "&sectionId=" + currentSectionId + "&reportId=" + currentReportId %}
            {% endif %}
            
            {% set breadcrumbItems = (breadcrumbItems.push({
                text: taskName,
                href: questionsHref
            }), breadcrumbItems) %}
        {% endif %}

        {% if currentQuestionName %}
            {% set breadcrumbItems = (breadcrumbItems.push({
                text: "Edit " + currentQuestionName
            }), breadcrumbItems) %}
        {% endif %}

        {{ govukBreadcrumbs({
            items: breadcrumbItems,
            classes: "govuk-!-margin-bottom-6"
        }) }}

        <div class="govuk-grid-row">
            <div class="govuk-grid-column-two-thirds">
                {{ macroPageHeader.pageHeader(pageNested,pageHeading,pageSection,pageHiddentext,pageSize) }}

                <form method="post" action="/funding/grant/reports/edit/question/update">
                    
                    {# Hidden fields to maintain context #}
                    <input type="hidden" name="questionId" value="{{ currentQuestionId }}">
                    <input type="hidden" name="taskId" value="{{ currentTaskId }}">
                    <input type="hidden" name="sectionId" value="{{ currentSectionId }}">
                    <input type="hidden" name="reportId" value="{{ currentReportId }}">
                    <input type="hidden" name="isUnassignedTask" value="{{ isUnassignedTask }}">

                    {{ govukInput({
                        label: {
                            text: "Question name",
                            classes: "govuk-label govuk-visually-hidden"
                        },                        
                        id: "questionName",
                        name: "questionName",
                        value: currentQuestionName,
                        classes: "govuk-!-width-two-thirds"
                    }) }}

                    <div class="govuk-button-group">
                        {{ govukButton({
                            text: "Save changes"
                        }) }}

                        {% if isUnassignedTask %}
                            {% set cancelHref = "/funding/grant/reports/questions?taskId=" + currentTaskId + "&reportId=" + currentReportId + "&unassigned=true" %}
                        {% else %}
                            {% set cancelHref = "/funding/grant/reports/questions?taskId=" + currentTaskId + "&sectionId=" + currentSectionId + "&reportId=" + currentReportId %}
                        {% endif %}

                        <a class="govuk-link govuk-link--no-visited-state" href="{{ cancelHref }}">Cancel</a>
                    </div>

                </form>
            </div>
        </div>

    </div>
</div>

{% endblock %}